# Options
set block-policy drop
set fingerprints "/etc/pf.os"
set ruleset-optimization basic
set state-policy if-bound
set skip on lo0

# Normalization

# Scrub incoming packets
scrub in all no-df
scrub all reassemble tcp

# Queueing

# Translation

# Filtering

# Antispoof
antispoof quick for { {{ antispoof_ifaces }} }

# Activate spoofing protection for all interfaces
block in quick from urpf-failed

# Block to/from illegal destinations or sources
block in quick from no-route to any

# Block by default
block all

{% if block_ips %}
# Block bad IPs
table <badguys> persist {{ blocklist_files }}
block return out quick from any to <badguys>
{% endif %}

# Allow critical system traffic
pass in quick inet proto udp from any port 67 to any port 68

# Allow outgoing traffic
pass out quick inet proto tcp from any to {{ gateway }} port 445 keep state
pass out quick inet proto tcp from any to any port 22 keep state
pass out quick inet proto tcp from any to any port 443 keep state
pass out quick inet proto tcp from any to any port 80 keep state
pass out quick inet proto udp from any to {{ dns }} port 53 keep state
pass out quick inet proto udp from any to any port 123 keep state
pass out quick inet proto udp from any to any port 443 keep state
