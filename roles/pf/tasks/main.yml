---
- name: provision /etc/pf.conf
  template:
    src: pf.conf.j2
    dest: /etc/pf.conf
    owner: root
    group: wheel
    mode: 0644
  notify:
    - flush all
    - restart fw
  tags:
    - pf

- name: provision anchor /etc/pf.anchors/pf.rules
  template:
    src: pf.rules.j2
    dest: /etc/pf.anchors/pf.rules
    owner: root
    group: wheel
    mode: 0644
  notify:
    - flush all
    - restart fw
  tags:
    - pf

- name: download DROP from spamhaus.org
  get_url:
    url: https://www.spamhaus.org/drop/drop.txt
    dest: /etc/pf.drop.txt
    force: yes
    owner: root
    group: wheel
  notify:
    - flush all
    - restart fw
  tags:
    - pf

- name: download EDROP from spamhaus.org
  get_url:
    url: https://www.spamhaus.org/drop/edrop.txt
    dest: /etc/pf.edrop.txt
    force: yes
    owner: root
    group: wheel
  notify:
    - flush all
    - restart fw
  tags:
    - pf

- name: replace ; with #
  replace:
    path: /etc/pf.drop.txt
    regexp: "; "
    replace: "# "
  notify:
    - flush all
    - restart fw
  tags:
    - pf

- name: replace ; with #
  replace:
    path: /etc/pf.edrop.txt
    regexp: "; "
    replace: "# "
  notify:
    - flush all
    - restart fw
  tags:
    - pf

- name: setup launchctl plist
  template:
    src: plist.j2
    dest: /Library/LaunchDaemons/pf.plist
    owner: root
    group: wheel
    mode: 0644
  tags:
    - pf
